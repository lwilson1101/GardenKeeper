<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>GardenKeeper</title>
<link href="https://fonts.googleapis.com/css2?family=Yeseva+One&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --sage: #7a9e7e;
    --sage-dark: #4d7a52;
    --sage-light: #b8d4bb;
    --cream: #f5f0e8;
    --cream-dark: #ede5d4;
    --soil: #6b4f3a;
    --soil-light: #a07850;
    --text: #2c2c2c;
    --text-muted: #7a7a7a;
    --white: #ffffff;
    --card: #fffdf9;
    --border: #e0d8c8;
    --danger: #c0574a;
    --water: #5b9bbf;
    --fertilize: #c09a3a;
    --radius: 16px;
    --shadow: 0 4px 20px rgba(0,0,0,0.08);
  }

- { box-sizing: border-box; margin: 0; padding: 0; }

body {
font-family: â€˜DM Sansâ€™, sans-serif;
background: var(â€“cream);
color: var(â€“text);
min-height: 100vh;
max-width: 480px;
margin: 0 auto;
position: relative;
font-size: 16px;
-webkit-text-size-adjust: 100%;
}
body.modal-open {
overflow: hidden;
position: fixed;
width: 100%;
}

.app-header {
background: linear-gradient(135deg, #2d5a32 0%, #4d7a52 60%, #3a6b40 100%);
padding: 0;
position: relative;
overflow: hidden;
}
.app-header::before {
content: â€˜â€™;
position: absolute;
top: -40px; right: -40px;
width: 180px; height: 180px;
border-radius: 50%;
background: rgba(255,255,255,0.05);
}
.app-header::after {
content: â€˜â€™;
position: absolute;
bottom: -20px; left: 30px;
width: 100px; height: 100px;
border-radius: 50%;
background: rgba(255,255,255,0.04);
}
.header-plants {
position: absolute;
bottom: 0; right: 0;
display: flex;
align-items: flex-end;
gap: 0px;
line-height: 1;
pointer-events: none;
}
.header-plant {
font-size: 42px;
opacity: 0.7;
transform-origin: bottom center;
filter: drop-shadow(0 3px 6px rgba(0,0,0,0.3));
}
.header-plant:nth-child(1) { transform: rotate(-12deg) translateY(6px); font-size: 36px; opacity: 0.6; }
.header-plant:nth-child(2) { transform: rotate(5deg) translateY(2px); font-size: 54px; opacity: 0.75; }
.header-plant:nth-child(3) { transform: rotate(-6deg) translateY(4px); font-size: 44px; opacity: 0.65; }
.header-plant:nth-child(4) { transform: rotate(8deg) translateY(0px); font-size: 58px; opacity: 0.8; }
.header-plant:nth-child(5) { transform: rotate(-4deg) translateY(3px); font-size: 40px; opacity: 0.6; }
.header-plant-left {
position: absolute;
bottom: 0; left: 0;
display: flex;
align-items: flex-end;
pointer-events: none;
}
.header-plant-left span {
font-size: 56px;
opacity: 0.5;
transform: rotate(15deg) translateY(4px) translateX(-8px);
transform-origin: bottom center;
display: block;
filter: drop-shadow(0 3px 6px rgba(0,0,0,0.25));
}
.app-title {
font-family: â€˜Yeseva Oneâ€™, serif;
font-size: 40px;
color: var(â€“white);
letter-spacing: 0.5px;
position: relative;
z-index: 1;
text-shadow: 0 3px 16px rgba(0,0,0,0.3);
line-height: 1.1;
}
.app-title span {
color: #a8d8ae;
}
.app-title .leaf-accent {
font-style: normal;
font-size: 26px;
vertical-align: middle;
margin-right: 8px;
filter: drop-shadow(0 2px 6px rgba(0,0,0,0.3));
}
.app-subtitle {
color: rgba(255,255,255,0.6);
font-size: 14px;
margin-top: 6px;
font-weight: 300;
letter-spacing: 0.8px;
position: relative;
z-index: 1;
}

/* Nav */
.nav {
display: flex;
background: var(â€“white);
border-bottom: 1px solid var(â€“border);
position: sticky;
top: 0;
z-index: 100;
box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}
.nav-btn {
flex: 1;
padding: 14px 4px 12px;
border: none;
background: transparent;
cursor: pointer;
font-family: â€˜DM Sansâ€™, sans-serif;
font-size: 11px;
font-weight: 500;
color: var(â€“text-muted);
display: flex;
flex-direction: column;
align-items: center;
gap: 4px;
letter-spacing: 0.3px;
transition: color 0.2s;
}
.nav-btn.active { color: var(â€“sage-dark); }
.nav-btn .icon { font-size: 20px; line-height: 1; }
.nav-btn.active .icon { transform: scale(1.1); }

/* Pages */
.page { display: none; padding: 20px 16px 100px; }
.page.active { display: block; }

/* Cards */
.card {
background: var(â€“card);
border-radius: var(â€“radius);
border: 1px solid var(â€“border);
padding: 16px;
margin-bottom: 12px;
box-shadow: var(â€“shadow);
}

/* Section title */
.section-title {
font-family: â€˜Playfair Displayâ€™, serif;
font-size: 24px;
color: var(â€“soil);
margin-bottom: 16px;
display: flex;
align-items: center;
justify-content: space-between;
}

/* Buttons */
.btn {
border: none;
border-radius: 12px;
cursor: pointer;
font-family: â€˜DM Sansâ€™, sans-serif;
font-weight: 500;
transition: all 0.15s;
display: inline-flex;
align-items: center;
gap: 6px;
}
.btn-primary {
background: var(â€“sage-dark);
color: white;
padding: 13px 20px;
font-size: 15px;
width: 100%;
justify-content: center;
}
.btn-primary:active { transform: scale(0.98); background: var(â€“sage); }
.btn-sm {
padding: 6px 14px;
font-size: 12px;
background: var(â€“cream-dark);
color: var(â€“text);
}
.btn-danger { background: #fde8e6; color: var(â€“danger); }
.btn-water { background: #e0f0f8; color: var(â€“water); }
.btn-fertilize { background: #fdf3dc; color: var(â€“fertilize); }

/* Form */
.form-group { margin-bottom: 14px; }
.form-label {
display: block;
font-size: 12px;
font-weight: 500;
color: var(â€“text-muted);
margin-bottom: 6px;
text-transform: uppercase;
letter-spacing: 0.5px;
}
.form-input, .form-select, .form-textarea {
width: 100%;
padding: 12px 14px;
border: 1.5px solid var(â€“border);
border-radius: 12px;
font-family: â€˜DM Sansâ€™, sans-serif;
font-size: 15px;
background: var(â€“white);
color: var(â€“text);
outline: none;
transition: border-color 0.2s;
-webkit-appearance: none;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
border-color: var(â€“sage);
}
.form-textarea { min-height: 80px; resize: vertical; }

/* Plant card */
.plant-card {
background: var(â€“card);
border-radius: var(â€“radius);
border: 1px solid var(â€“border);
margin-bottom: 12px;
overflow: hidden;
box-shadow: var(â€“shadow);
}
.plant-card-header {
display: flex;
align-items: center;
padding: 14px 16px;
gap: 12px;
cursor: pointer;
}
.plant-photo {
width: 52px; height: 52px;
border-radius: 12px;
background: var(â€“sage-light);
display: flex; align-items: center; justify-content: center;
font-size: 26px;
flex-shrink: 0;
overflow: hidden;
}
.plant-photo img { width: 100%; height: 100%; object-fit: cover; }
.plant-info { flex: 1; min-width: 0; }
.plant-name {
font-family: â€˜Playfair Displayâ€™, serif;
font-size: 18px;
font-weight: 700;
}
.plant-meta {
font-size: 13px;
color: var(â€“text-muted);
margin-top: 2px;
}
.plant-tag {
font-size: 10px;
background: var(â€“sage-light);
color: var(â€“sage-dark);
padding: 3px 8px;
border-radius: 20px;
font-weight: 500;
}
.plant-card-body {
border-top: 1px solid var(â€“border);
padding: 14px 16px;
display: none;
}
.plant-card-body.open { display: block; }
.plant-detail-row {
display: flex;
justify-content: space-between;
font-size: 13px;
margin-bottom: 8px;
}
.plant-detail-label { color: var(â€“text-muted); }

/* Log entries */
.log-entry {
display: flex;
align-items: flex-start;
gap: 10px;
padding: 10px 0;
border-bottom: 1px solid var(â€“border);
}
.log-entry:last-child { border-bottom: none; }
.log-dot {
width: 32px; height: 32px;
border-radius: 50%;
display: flex; align-items: center; justify-content: center;
font-size: 14px;
flex-shrink: 0;
}
.log-dot.water { background: #e0f0f8; }
.log-dot.fertilize { background: #fdf3dc; }
.log-info { flex: 1; }
.log-plant { font-weight: 500; font-size: 13px; }
.log-details { font-size: 12px; color: var(â€“text-muted); margin-top: 2px; }
.log-date { font-size: 11px; color: var(â€“text-muted); white-space: nowrap; }

/* Notes */
.note-card {
background: var(â€“card);
border-radius: var(â€“radius);
border: 1px solid var(â€“border);
margin-bottom: 12px;
overflow: hidden;
box-shadow: var(â€“shadow);
}
.note-card-header {
display: flex;
align-items: center;
justify-content: space-between;
padding: 14px 16px;
cursor: pointer;
}
.note-category {
font-family: â€˜Playfair Displayâ€™, serif;
font-size: 18px;
}
.note-card-body {
border-top: 1px solid var(â€“border);
padding: 14px 16px;
font-size: 14px;
line-height: 1.6;
color: var(â€“text);
display: none;
white-space: pre-wrap;
}
.note-card-body.open { display: block; }

/* Reminders */
.reminder-card {
background: var(â€“card);
border-radius: var(â€“radius);
border: 1px solid var(â€“border);
padding: 14px 16px;
margin-bottom: 10px;
display: flex;
align-items: center;
gap: 12px;
box-shadow: var(â€“shadow);
}
.reminder-icon {
width: 40px; height: 40px;
border-radius: 12px;
display: flex; align-items: center; justify-content: center;
font-size: 18px;
flex-shrink: 0;
}

/* Modal */
.modal-overlay {
display: none;
position: fixed;
inset: 0;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0,0,0,0.7);
z-index: 500;
align-items: flex-end;
-webkit-overflow-scrolling: touch;
}
.modal-overlay.open {
display: flex;
}
.modal {
background: var(â€“cream);
border-radius: 24px 24px 0 0;
padding: 24px 20px 60px;
width: 100%;
max-height: 88vh;
overflow-y: auto;
-webkit-overflow-scrolling: touch;
animation: slideUp 0.3s ease;
position: relative;
z-index: 501;
}
@keyframes slideUp {
from { transform: translateY(100%); }
to { transform: translateY(0); }
}
.modal-title {
font-family: â€˜Playfair Displayâ€™, serif;
font-size: 26px;
margin-bottom: 20px;
color: var(â€“soil);
}
.modal-close {
float: right;
background: var(â€“cream-dark);
border: none;
border-radius: 50%;
width: 32px; height: 32px;
font-size: 16px;
cursor: pointer;
display: flex; align-items: center; justify-content: center;
}

/* FAB */
.fab {
position: fixed;
bottom: 80px;
right: calc(50% - 240px + 16px);
width: 56px; height: 56px;
border-radius: 50%;
background: var(â€“sage-dark);
color: white;
border: none;
font-size: 26px;
cursor: pointer;
box-shadow: 0 6px 20px rgba(77,122,82,0.4);
display: flex; align-items: center; justify-content: center;
z-index: 200;
transition: transform 0.15s;
}
.fab:active { transform: scale(0.92); }

/* Empty state */
.empty {
text-align: center;
padding: 40px 20px;
color: var(â€“text-muted);
}
.empty-icon { font-size: 48px; margin-bottom: 12px; }
.empty-text { font-size: 14px; }

/* Photo gallery */
.photo-add-btn {
width: 100%;
padding: 14px;
border: 2px dashed var(â€“sage-light);
border-radius: 12px;
display: flex;
align-items: center;
justify-content: center;
gap: 8px;
background: #f0f7f1;
font-size: 14px;
color: var(â€“sage-dark);
cursor: pointer;
font-family: â€˜DM Sansâ€™, sans-serif;
font-weight: 500;
position: relative;
}
.photo-add-btn input { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; }

.photo-pending-list { margin-top: 10px; display: flex; flex-direction: column; gap: 10px; }
.photo-pending-item {
display: flex; align-items: center; gap: 10px;
background: var(â€“white); border-radius: 12px; padding: 8px; border: 1px solid var(â€“border);
}
.photo-pending-thumb {
width: 56px; height: 56px; border-radius: 8px; object-fit: cover; flex-shrink: 0;
}
.photo-pending-remove {
margin-left: auto; background: #fde8e6; border: none; border-radius: 8px;
color: var(â€“danger); font-size: 12px; padding: 4px 8px; cursor: pointer; font-family: â€˜DM Sansâ€™, sans-serif;
}

/* Gallery in plant card */
.photo-gallery {
display: flex; gap: 8px; overflow-x: auto; padding-bottom: 4px; margin-bottom: 12px;
scrollbar-width: none;
}
.photo-gallery::-webkit-scrollbar { display: none; }
.gallery-item {
flex-shrink: 0; position: relative; cursor: pointer;
border-radius: 10px; overflow: hidden;
width: 90px; height: 90px;
border: 2px solid var(â€“border);
}
.gallery-item img { width: 100%; height: 100%; object-fit: cover; }
.gallery-item-date {
position: absolute; bottom: 0; left: 0; right: 0;
background: rgba(0,0,0,0.55); color: white;
font-size: 8px; text-align: center; padding: 3px 2px;
font-weight: 500;
}
.gallery-item-del {
position: absolute; top: 3px; right: 3px;
background: rgba(0,0,0,0.5); border: none; border-radius: 50%;
color: white; font-size: 10px; width: 18px; height: 18px;
display: flex; align-items: center; justify-content: center;
cursor: pointer; line-height: 1;
}

/* Lightbox */
.lightbox {
display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.92);
z-index: 1000; flex-direction: column; align-items: center; justify-content: center;
}
.lightbox.open { display: flex; }
.lightbox-img { max-width: 96vw; max-height: 75vh; border-radius: 12px; object-fit: contain; }
.lightbox-date { color: rgba(255,255,255,0.7); font-size: 14px; margin-top: 12px; }
.lightbox-nav { display: flex; gap: 20px; margin-top: 16px; }
.lightbox-btn {
background: rgba(255,255,255,0.15); border: none; color: white;
border-radius: 50%; width: 44px; height: 44px; font-size: 20px;
cursor: pointer; display: flex; align-items: center; justify-content: center;
}
.lightbox-close {
position: absolute; top: 20px; right: 20px;
background: rgba(255,255,255,0.15); border: none; color: white;
border-radius: 50%; width: 36px; height: 36px; font-size: 18px;
cursor: pointer; display: flex; align-items: center; justify-content: center;
}
.lightbox-counter { color: rgba(255,255,255,0.5); font-size: 12px; margin-top: 8px; }

/* Auth screen */
.auth-screen {
display: none;
position: fixed;
inset: 0;
background: linear-gradient(160deg, #2d5a32 0%, #4d7a52 50%, #3a6b40 100%);
z-index: 2000;
flex-direction: column;
align-items: center;
justify-content: center;
padding: 32px 24px;
overflow: hidden;
}
.auth-screen.open { display: flex; }
.auth-screen::before {
content: â€˜ğŸŒ¿ğŸª´â˜˜ï¸ğŸŒ±ğŸŒ¾ğŸƒâ€™;
position: absolute;
bottom: -10px; right: -10px;
font-size: 60px;
letter-spacing: -8px;
opacity: 0.25;
line-height: 1;
filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
pointer-events: none;
}
.auth-logo {
font-family: â€˜Yeseva Oneâ€™, serif;
font-size: 42px;
color: white;
text-shadow: 0 3px 16px rgba(0,0,0,0.3);
margin-bottom: 6px;
text-align: center;
}
.auth-logo span { color: #a8d8ae; }
.auth-tagline {
color: rgba(255,255,255,0.6);
font-size: 14px;
letter-spacing: 0.6px;
margin-bottom: 36px;
text-align: center;
}
.auth-card {
background: var(â€“cream);
border-radius: 24px;
padding: 28px 24px;
width: 100%;
max-width: 400px;
box-shadow: 0 20px 60px rgba(0,0,0,0.25);
}
.auth-tabs {
display: flex;
background: var(â€“cream-dark);
border-radius: 12px;
padding: 4px;
margin-bottom: 24px;
gap: 4px;
}
.auth-tab {
flex: 1; padding: 10px;
border: none; border-radius: 8px;
background: transparent; cursor: pointer;
font-family: â€˜DM Sansâ€™, sans-serif;
font-size: 14px; font-weight: 500;
color: var(â€“text-muted);
transition: all 0.2s;
}
.auth-tab.active {
background: var(â€“white);
color: var(â€“sage-dark);
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}
.auth-error {
background: #fde8e6; color: var(â€“danger);
border-radius: 10px; padding: 10px 14px;
font-size: 13px; margin-bottom: 14px;
display: none;
}
.auth-error.show { display: block; }
.auth-success {
background: #e8f5e9; color: var(â€“sage-dark);
border-radius: 10px; padding: 10px 14px;
font-size: 13px; margin-bottom: 14px;
display: none;
}
.auth-success.show { display: block; }

/* User bar */
.user-bar {
display: flex;
align-items: center;
justify-content: space-between;
background: rgba(0,0,0,0.15);
padding: 8px 16px 8px 20px;
}
.user-bar-name {
font-size: 13px;
color: rgba(255,255,255,0.8);
font-weight: 500;
}
.logout-btn {
background: rgba(255,255,255,0.15);
border: none; border-radius: 8px;
color: white; font-size: 12px;
padding: 5px 12px; cursor: pointer;
font-family: â€˜DM Sansâ€™, sans-serif;
font-weight: 500;
transition: background 0.15s;
}
.logout-btn:active { background: rgba(255,255,255,0.25); }
.env-tabs {
display: flex;
background: var(â€“cream-dark);
border-radius: 14px;
padding: 4px;
margin-bottom: 16px;
gap: 4px;
}
.env-tab {
flex: 1;
padding: 10px;
border: none;
border-radius: 10px;
background: transparent;
cursor: pointer;
font-family: â€˜DM Sansâ€™, sans-serif;
font-size: 13px;
font-weight: 500;
color: var(â€“text-muted);
transition: all 0.2s;
}
.env-tab.active {
background: var(â€“white);
color: var(â€“sage-dark);
box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.chip-row { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 14px; }
.chip {
padding: 6px 14px;
border-radius: 20px;
font-size: 12px;
border: 1.5px solid var(â€“border);
background: var(â€“white);
cursor: pointer;
transition: all 0.15s;
font-family: â€˜DM Sansâ€™, sans-serif;
}
.chip.selected { background: var(â€“sage-dark); color: white; border-color: var(â€“sage-dark); }
</style>

</head>
<body>

<!-- AUTH SCREEN -->

<div class="auth-screen open" id="auth-screen">
  <div class="auth-logo">ğŸª´ Garden<span>Keeper</span></div>
  <div class="auth-tagline">Your personal plant companion</div>
  <div class="auth-card">
    <div class="auth-tabs">
      <button class="auth-tab active" id="atab-login" onclick="switchAuthTab('login')">Sign In</button>
      <button class="auth-tab" id="atab-register" onclick="switchAuthTab('register')">Create Account</button>
    </div>
    <div class="auth-error" id="auth-error"></div>
    <div class="auth-success" id="auth-success"></div>

```
<!-- Login form -->
<div id="auth-login-form">
  <div class="form-group">
    <label class="form-label">Username</label>
    <input class="form-input" id="login-username" placeholder="Your username" autocomplete="username">
  </div>
  <div class="form-group">
    <label class="form-label">Password</label>
    <input class="form-input" type="password" id="login-password" placeholder="Your password" autocomplete="current-password">
  </div>
  <button class="btn btn-primary" onclick="doLogin()" style="margin-top:4px">Sign In ğŸŒ¿</button>
  <div style="text-align:center;margin-top:16px;font-size:13px;color:var(--text-muted)">Forgot your password? Please contact the app owner.</div>
</div>

<!-- Register form -->
<div id="auth-register-form" style="display:none">
  <div class="form-group">
    <label class="form-label">Your Name</label>
    <input class="form-input" id="reg-name" placeholder="e.g. Sarah">
  </div>
  <div class="form-group">
    <label class="form-label">Username</label>
    <input class="form-input" id="reg-username" placeholder="Choose a username">
  </div>
  <div class="form-group">
    <label class="form-label">Password</label>
    <input class="form-input" type="password" id="reg-password" placeholder="Choose a password">
  </div>
  <div class="form-group">
    <label class="form-label">Confirm Password</label>
    <input class="form-input" type="password" id="reg-password2" placeholder="Repeat your password">
  </div>
  <button class="btn btn-primary" onclick="doRegister()" style="margin-top:4px">Create Account ğŸŒ±</button>
</div>
```

  </div>
</div>

<!-- Header -->

<div class="app-header">
  <div class="user-bar">
    <div class="user-bar-name" id="user-bar-name">ğŸ‘¤ </div>
    <button class="logout-btn" onclick="doLogout()">Sign Out</button>
  </div>
  <div style="padding: 20px 24px 20px">
    <div class="header-plant-left"><span>ğŸƒ</span></div>
    <div class="header-plants">
      <div class="header-plant">ğŸŒ¿</div>
      <div class="header-plant">ğŸª´</div>
      <div class="header-plant">â˜˜ï¸</div>
      <div class="header-plant">ğŸŒ±</div>
      <div class="header-plant">ğŸŒ¾</div>
    </div>
    <div class="app-title"><span class="leaf-accent">ğŸª´</span>Garden<span>Keeper</span></div>
    <div class="app-subtitle">Your personal plant companion</div>
  </div>
</div>

<!-- Nav -->

<div class="nav">
  <button class="nav-btn active" onclick="showPage('inventory')">
    <span class="icon">ğŸŒ¿</span>Plants
  </button>
  <button class="nav-btn" onclick="showPage('log')">
    <span class="icon">ğŸ’§</span>Log
  </button>
  <button class="nav-btn" onclick="showPage('reminders')">
    <span class="icon">ğŸ””</span>Reminders
  </button>
  <button class="nav-btn" onclick="showPage('notes')">
    <span class="icon">ğŸ““</span>Notes
  </button>
</div>

<!-- INVENTORY PAGE -->

<div class="page active" id="page-inventory">
  <div class="section-title">
    <span>My Plants</span>
    <span id="plant-count" style="font-size:14px;font-family:'DM Sans';color:var(--text-muted);"></span>
  </div>
  <div class="env-tabs">
    <button class="env-tab active" id="envtab-indoor" onclick="switchEnv('indoor')">ğŸªŸ Indoor</button>
    <button class="env-tab" id="envtab-outdoor" onclick="switchEnv('outdoor')">ğŸŒ¿ Outdoor</button>
  </div>
  <div id="plant-list"></div>
</div>

<!-- LOG PAGE -->

<div class="page" id="page-log">
  <div class="section-title">Watering & Feeding Log</div>
  <div id="log-list"></div>
</div>

<!-- REMINDERS PAGE -->

<div class="page" id="page-reminders">
  <div class="section-title">Reminders</div>
  <div id="reminder-list"></div>
</div>

<!-- NOTES PAGE -->

<div class="page" id="page-notes">
  <div class="section-title">Garden Notes</div>
  <div id="note-list"></div>
</div>

<!-- LIGHTBOX -->

<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <button class="lightbox-close" onclick="closeLightbox()">âœ•</button>
  <img class="lightbox-img" id="lightbox-img" src="" onclick="event.stopPropagation()">
  <div class="lightbox-date" id="lightbox-date"></div>
  <div class="lightbox-counter" id="lightbox-counter"></div>
  <div class="lightbox-nav" onclick="event.stopPropagation()">
    <button class="lightbox-btn" onclick="lightboxNav(-1)">â€¹</button>
    <button class="lightbox-btn" onclick="lightboxNav(1)">â€º</button>
  </div>
</div>

<!-- FAB -->

<button class="fab" id="fab" onclick="openFab()">+</button>

<!-- PLANT MODAL -->

<div class="modal-overlay" id="plant-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('plant-modal')">âœ•</button>
    <div class="modal-title" id="plant-modal-title">Add Plant</div>
    <input type="hidden" id="plant-edit-id">
    <div class="form-group">
      <label class="form-label">Photos</label>
      <div class="photo-add-btn">
        ğŸ“· Add a Photo
        <input type="file" id="plant-photo-input" accept="image/*" onchange="handlePhoto(event)">
      </div>
      <div class="photo-pending-list" id="photo-pending-list"></div>
    </div>
    <div class="form-group">
      <label class="form-label">Plant Name *</label>
      <input class="form-input" id="plant-name" placeholder="e.g. Tomato, Basil, Rose">
    </div>
    <div class="form-group">
      <label class="form-label">Environment *</label>
      <div class="chip-row" style="margin-bottom:0">
        <div class="chip selected" id="envchip-indoor" onclick="selectEnvChip('indoor')">ğŸªŸ Indoor</div>
        <div class="chip" id="envchip-outdoor" onclick="selectEnvChip('outdoor')">ğŸŒ¿ Outdoor</div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Type / Category</label>
      <input class="form-input" id="plant-type" placeholder="e.g. Vegetable, Herb, Flower">
    </div>
    <div class="form-group">
      <label class="form-label">Location</label>
      <input class="form-input" id="plant-location" placeholder="e.g. Back garden bed, Pot on windowsill">
    </div>
    <div class="form-group">
      <label class="form-label">Soil Type</label>
      <input class="form-input" id="plant-soil" placeholder="e.g. Well-draining, Sandy loam, Peat-based">
    </div>
    <div class="form-group">
      <label class="form-label">Light Requirements</label>
      <div class="chip-row" style="margin-bottom:0">
        <div class="chip" id="lchip-full" onclick="selectLight('Full Sun')">â˜€ï¸ Full Sun</div>
        <div class="chip" id="lchip-partial" onclick="selectLight('Partial Sun')">â›… Partial Sun</div>
        <div class="chip" id="lchip-shade" onclick="selectLight('Shade')">ğŸŒ¥ï¸ Shade</div>
        <div class="chip" id="lchip-indoor" onclick="selectLight('Indoor')">ğŸªŸ Indoor</div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Last Repot Date</label>
      <input class="form-input" type="date" id="plant-repot-date">
    </div>
    <div class="form-group">
      <label class="form-label">Humidity Requirements</label>
      <div class="chip-row" style="margin-bottom:0">
        <div class="chip" id="hchip-low" onclick="selectHumidity('Low')">ğŸœï¸ Low</div>
        <div class="chip" id="hchip-medium" onclick="selectHumidity('Medium')">ğŸŒ¤ï¸ Medium</div>
        <div class="chip" id="hchip-high" onclick="selectHumidity('High')">ğŸ’¦ High</div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Care Notes</label>
      <textarea class="form-textarea" id="plant-notes" placeholder="Watering frequency, tips..."></textarea>
    </div>
    <button class="btn btn-primary" onclick="savePlant()">Save Plant ğŸŒ±</button>
  </div>
</div>

<!-- LOG MODAL -->

<div class="modal-overlay" id="log-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('log-modal')">âœ•</button>
    <div class="modal-title">Log Activity</div>
    <div class="form-group">
      <label class="form-label">Plant</label>
      <select class="form-select" id="log-plant-select">
        <option value="">Select a plant...</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">Activity Type</label>
      <div class="chip-row">
        <div class="chip selected" id="chip-water" onclick="selectType('water')">ğŸ’§ Watered</div>
        <div class="chip" id="chip-fertilize" onclick="selectType('fertilize')">ğŸŒ¾ Fertilized</div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Date</label>
      <input class="form-input" type="date" id="log-date">
    </div>
    <div class="form-group">
      <label class="form-label">Product / Mix Used</label>
      <input class="form-input" id="log-product" placeholder="e.g. Tomato feed, Seaweed solution">
    </div>
    <div class="form-group">
      <label class="form-label">Quantity & Blend Details</label>
      <textarea class="form-textarea" id="log-quantity" placeholder="e.g. 500ml total&#10;NPK 5-3-8 @ 2ml/L&#10;Cal-Mag @ 1ml/L&#10;Seaweed @ 0.5ml/L"></textarea>
    </div>
    <div class="form-group">
      <label class="form-label">Notes</label>
      <textarea class="form-textarea" id="log-notes" placeholder="Any observations..."></textarea>
    </div>
    <button class="btn btn-primary" onclick="saveLog()">Save Entry ğŸ’§</button>
  </div>
</div>

<!-- REMINDER MODAL -->

<div class="modal-overlay" id="reminder-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('reminder-modal')">âœ•</button>
    <div class="modal-title">Add Reminder</div>
    <div class="form-group">
      <label class="form-label">Plant</label>
      <select class="form-select" id="reminder-plant-select">
        <option value="">All plants / General</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">Activity</label>
      <div class="chip-row">
        <div class="chip selected" id="rchip-water" onclick="selectRType('water')">ğŸ’§ Water</div>
        <div class="chip" id="rchip-fertilize" onclick="selectRType('fertilize')">ğŸŒ¾ Fertilize</div>
        <div class="chip" id="rchip-other" onclick="selectRType('other')">ğŸ“‹ Other</div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Label</label>
      <input class="form-input" id="reminder-label" placeholder="e.g. Water tomatoes">
    </div>
    <div class="form-group">
      <label class="form-label">Frequency</label>
      <select class="form-select" id="reminder-freq">
        <option value="daily">Every day</option>
        <option value="2days">Every 2 days</option>
        <option value="weekly" selected>Every week</option>
        <option value="2weeks">Every 2 weeks</option>
        <option value="monthly">Every month</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">Next Due Date</label>
      <input class="form-input" type="date" id="reminder-date">
    </div>
    <button class="btn btn-primary" onclick="saveReminder()">Set Reminder ğŸ””</button>
  </div>
</div>

<!-- NOTE MODAL -->

<div class="modal-overlay" id="note-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('note-modal')">âœ•</button>
    <div class="modal-title" id="note-modal-title">Add Note</div>
    <input type="hidden" id="note-edit-id">
    <div class="form-group">
      <label class="form-label">Plant Category</label>
      <input class="form-input" id="note-category" placeholder="e.g. Tomatoes, Herbs, Citrus">
    </div>
    <div class="form-group">
      <label class="form-label">Nutrient Mix & Notes</label>
      <textarea class="form-textarea" id="note-content" placeholder="e.g. NPK 10-5-5 diluted at 5ml per litre, applied fortnightly..." style="min-height:140px"></textarea>
    </div>
    <button class="btn btn-primary" onclick="saveNote()">Save Note ğŸ““</button>
  </div>
</div>

<script>
// ---- AUTH ----
let currentUser = null; // { username, name }

function getUsers() {
  try { return JSON.parse(localStorage.getItem('gk_users') || '{}'); } catch(e) { return {}; }
}
function saveUsers(users) {
  localStorage.setItem('gk_users', JSON.stringify(users));
}

function hashish(str) {
  // Simple deterministic hash â€” not crypto-secure but fine for friendly sharing
  let h = 0;
  for (let i = 0; i < str.length; i++) { h = Math.imul(31, h) + str.charCodeAt(i) | 0; }
  return h.toString(36);
}

function switchAuthTab(tab) {
  document.getElementById('atab-login').classList.toggle('active', tab === 'login');
  document.getElementById('atab-register').classList.toggle('active', tab === 'register');
  document.getElementById('auth-login-form').style.display = tab === 'login' ? '' : 'none';
  document.getElementById('auth-register-form').style.display = tab === 'register' ? '' : 'none';
  clearAuthMessages();
}

function clearAuthMessages() {
  document.getElementById('auth-error').classList.remove('show');
  document.getElementById('auth-success').classList.remove('show');
}
function showAuthError(msg) {
  const el = document.getElementById('auth-error');
  el.textContent = msg; el.classList.add('show');
  document.getElementById('auth-success').classList.remove('show');
}
function showAuthSuccess(msg) {
  const el = document.getElementById('auth-success');
  el.textContent = msg; el.classList.add('show');
  document.getElementById('auth-error').classList.remove('show');
}

function doLogin() {
  const username = document.getElementById('login-username').value.trim().toLowerCase();
  const password = document.getElementById('login-password').value;
  if (!username || !password) { showAuthError('Please enter your username and password.'); return; }
  const users = getUsers();
  if (!users[username]) { showAuthError('No account found with that username.'); return; }
  if (users[username].passwordHash !== hashish(password)) { showAuthError('Incorrect password. Please try again.'); return; }
  loginSuccess(username, users[username].name);
}

function doRegister() {
  const name = document.getElementById('reg-name').value.trim();
  const username = document.getElementById('reg-username').value.trim().toLowerCase();
  const password = document.getElementById('reg-password').value;
  const password2 = document.getElementById('reg-password2').value;
  if (!name || !username || !password) { showAuthError('Please fill in all fields.'); return; }
  if (password !== password2) { showAuthError('Passwords do not match.'); return; }
  if (password.length < 6) { showAuthError('Password must be at least 6 characters.'); return; }
  if (!/^[a-z0-9_]+$/.test(username)) { showAuthError('Username can only contain letters, numbers and underscores.'); return; }
  const users = getUsers();
  if (users[username]) { showAuthError('That username is already taken. Please choose another.'); return; }
  users[username] = { name, passwordHash: hashish(password) };
  saveUsers(users);
  showAuthSuccess(`Account created! Signing you in, ${name}...`);
  setTimeout(() => loginSuccess(username, name), 1000);
}

function loginSuccess(username, name) {
  currentUser = { username, name };
  localStorage.setItem('gk_session', JSON.stringify(currentUser));
  document.getElementById('auth-screen').classList.remove('open');
  document.getElementById('user-bar-name').textContent = `ğŸ‘¤ ${name}`;
  load();
  renderAll();
}

function doLogout() {
  if (!confirm('Sign out of GardenKeeper?')) return;
  currentUser = null;
  localStorage.removeItem('gk_session');
  state = { plants: [], logs: [], reminders: [], notes: [] };
  document.getElementById('auth-screen').classList.add('open');
  document.getElementById('login-username').value = '';
  document.getElementById('login-password').value = '';
  clearAuthMessages();
  switchAuthTab('login');
}

// ---- STATE ----
let state = {
  plants: [],
  logs: [],
  reminders: [],
  notes: []
};

let currentPage = 'inventory';
let currentLogType = 'water';
let currentRType = 'water';
let currentLight = '';
let currentHumidity = '';
let currentEnv = 'indoor';
let currentEnvFilter = 'indoor';
let pendingPhotos = []; // [{data, date}] for photos being added in modal
let lightboxPhotos = [];
let lightboxIndex = 0;

// ---- PERSIST ----
function save() {
  if (!currentUser) return;
  try { localStorage.setItem('gk_data_' + currentUser.username, JSON.stringify(state)); } catch(e) {}
}
function load() {
  if (!currentUser) return;
  try {
    const d = localStorage.getItem('gk_data_' + currentUser.username);
    if (d) {
      state = JSON.parse(d);
      // migrate old single-photo plants
      state.plants = state.plants.map(p => {
        if (!p.photos) {
          p.photos = p.photo ? [{ data: p.photo, date: p.photoDate || '' }] : [];
          delete p.photo; delete p.photoDate;
        }
        return p;
      });
    } else {
      state = { plants: [], logs: [], reminders: [], notes: [] };
    }
  } catch(e) {}
}

// ---- NAV ----
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  document.querySelectorAll('.nav-btn')[['inventory','log','reminders','notes'].indexOf(page)].classList.add('active');
  currentPage = page;
  renderAll();
}

// ---- FAB ----
function openFab() {
  if (currentPage === 'inventory') openPlantModal();
  else if (currentPage === 'log') { populatePlantSelect('log-plant-select'); document.getElementById('log-date').value = today(); openModal('log-modal'); }
  else if (currentPage === 'reminders') { populatePlantSelect('reminder-plant-select', true); document.getElementById('reminder-date').value = today(); openModal('reminder-modal'); }
  else if (currentPage === 'notes') openNoteModal();
}

function today() { return new Date().toISOString().split('T')[0]; }

// ---- MODALS ----
function openModal(id) { 
  document.getElementById(id).classList.add('open'); 
  document.body.classList.add('modal-open');
}
function closeModal(id) { 
  document.getElementById(id).classList.remove('open'); 
  document.body.classList.remove('modal-open');
}

function openNoteModal(id) {
  document.getElementById('note-edit-id').value = id || '';
  document.getElementById('note-modal-title').textContent = id ? 'Edit Note' : 'Add Note';
  if (id) {
    const n = state.notes.find(n => n.id === id);
    document.getElementById('note-category').value = n.category;
    document.getElementById('note-content').value = n.content;
  } else {
    document.getElementById('note-category').value = '';
    document.getElementById('note-content').value = '';
  }
  openModal('note-modal');
}

function openPlantModal(id) {
  pendingPhotos = [];
  document.getElementById('plant-edit-id').value = id || '';
  document.getElementById('plant-modal-title').textContent = id ? 'Edit Plant' : 'Add Plant';

  if (id) {
    const p = state.plants.find(p => p.id === id);
    document.getElementById('plant-name').value = p.name;
    document.getElementById('plant-type').value = p.type;
    document.getElementById('plant-location').value = p.location;
    document.getElementById('plant-soil').value = p.soil || '';
    document.getElementById('plant-repot-date').value = p.repotDate || '';
    document.getElementById('plant-notes').value = p.notes;
    selectLight(p.light || '');
    selectHumidity(p.humidity || '');
    selectEnvChip(p.env || 'outdoor');
    // Load existing photos into pending so user can see and remove them
    pendingPhotos = (p.photos || []).map(ph => ({ ...ph, existing: true }));
  } else {
    document.getElementById('plant-name').value = '';
    document.getElementById('plant-type').value = '';
    document.getElementById('plant-location').value = '';
    document.getElementById('plant-soil').value = '';
    document.getElementById('plant-repot-date').value = '';
    document.getElementById('plant-notes').value = '';
    selectLight('');
    selectHumidity('');
    selectEnvChip(currentEnvFilter);
  }
  renderPendingPhotos();
  openModal('plant-modal');
}

// ---- PHOTO ----
function handlePhoto(e) {
  const file = e.target.files[0];
  if (!file) return;
  e.target.value = ''; // reset so same file can be picked again
  const reader = new FileReader();
  reader.onload = function(ev) {
    pendingPhotos.push({ data: ev.target.result, date: today() });
    renderPendingPhotos();
  };
  reader.readAsDataURL(file);
}

function renderPendingPhotos() {
  const list = document.getElementById('photo-pending-list');
  if (!pendingPhotos.length) { list.innerHTML = ''; return; }
  list.innerHTML = pendingPhotos.map((ph, i) => `
    <div class="photo-pending-item">
      <img class="photo-pending-thumb" src="${ph.data}">
      <div style="flex:1">
        <div style="font-size:11px;color:var(--text-muted);margin-bottom:4px;text-transform:uppercase;letter-spacing:0.4px">Photo Date</div>
        <input class="form-input" type="date" value="${ph.date}" onchange="pendingPhotos[${i}].date=this.value" style="padding:8px 10px;font-size:13px">
      </div>
      <button class="photo-pending-remove" onclick="removePending(${i})">âœ•</button>
    </div>
  `).join('');
}

function removePending(i) {
  pendingPhotos.splice(i, 1);
  renderPendingPhotos();
}

// ---- PLANTS ----
function savePlant() {
  const name = document.getElementById('plant-name').value.trim();
  if (!name) { alert('Please enter a plant name.'); return; }
  const id = document.getElementById('plant-edit-id').value;
  const plant = {
    id: id || Date.now().toString(),
    name,
    type: document.getElementById('plant-type').value.trim(),
    location: document.getElementById('plant-location').value.trim(),
    soil: document.getElementById('plant-soil').value.trim(),
    light: currentLight,
    humidity: currentHumidity,
    repotDate: document.getElementById('plant-repot-date').value || null,
    env: currentEnv,
    notes: document.getElementById('plant-notes').value.trim(),
    photos: pendingPhotos.map(ph => ({ data: ph.data, date: ph.date })),
    added: new Date().toISOString()
  };
  if (id) {
    state.plants = state.plants.map(p => p.id === id ? plant : p);
  } else {
    state.plants.push(plant);
  }
  save();
  closeModal('plant-modal');
  renderAll();
}

function deletePlant(id) {
  if (!confirm('Delete this plant and all its photos?')) return;
  state.plants = state.plants.filter(p => p.id !== id);
  save(); renderAll();
}

function deletePhotoFromPlant(plantId, photoIndex) {
  const p = state.plants.find(p => p.id === plantId);
  if (!p) return;
  p.photos.splice(photoIndex, 1);
  save(); renderAll();
}

function togglePlantCard(id) {
  document.getElementById('pbody-' + id).classList.toggle('open');
}

// ---- LIGHTBOX ----
function openLightbox(photos, index) {
  lightboxPhotos = photos;
  lightboxIndex = index;
  updateLightbox();
  document.getElementById('lightbox').classList.add('open');
}
function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
}
function lightboxNav(dir) {
  lightboxIndex = (lightboxIndex + dir + lightboxPhotos.length) % lightboxPhotos.length;
  updateLightbox();
}
function updateLightbox() {
  const ph = lightboxPhotos[lightboxIndex];
  document.getElementById('lightbox-img').src = ph.data;
  document.getElementById('lightbox-date').textContent = ph.date ? 'ğŸ“¸ ' + formatDate(ph.date) : '';
  document.getElementById('lightbox-counter').textContent = `${lightboxIndex + 1} of ${lightboxPhotos.length}`;
}

function switchEnv(env) {
  currentEnvFilter = env;
  document.getElementById('envtab-outdoor').classList.toggle('active', env === 'outdoor');
  document.getElementById('envtab-indoor').classList.toggle('active', env === 'indoor');
  renderInventory();
}

function selectEnvChip(env) {
  currentEnv = env;
  document.getElementById('envchip-outdoor').classList.toggle('selected', env === 'outdoor');
  document.getElementById('envchip-indoor').classList.toggle('selected', env === 'indoor');
}

function selectHumidity(val) {
  currentHumidity = val;
  ['Low','Medium','High'].forEach(k => {
    const el = document.getElementById('hchip-' + k.toLowerCase());
    if (el) el.classList.toggle('selected', k === val);
  });
}

function selectLight(val) {
  currentLight = val;
  const map = {'Full Sun':'full','Partial Sun':'partial','Shade':'shade','Indoor':'indoor'};
  Object.keys(map).forEach(k => {
    const el = document.getElementById('lchip-' + map[k]);
    if (el) el.classList.toggle('selected', k === val);
  });
}

// ---- LOG ----
function selectType(t) {
  currentLogType = t;
  document.getElementById('chip-water').classList.toggle('selected', t === 'water');
  document.getElementById('chip-fertilize').classList.toggle('selected', t === 'fertilize');
}

function saveLog() {
  const plantId = document.getElementById('log-plant-select').value;
  const date = document.getElementById('log-date').value;
  if (!plantId || !date) { alert('Please select a plant and date.'); return; }
  state.logs.push({
    id: Date.now().toString(),
    plantId,
    type: currentLogType,
    date,
    product: document.getElementById('log-product').value.trim(),
    quantity: document.getElementById('log-quantity').value.trim(),
    notes: document.getElementById('log-notes').value.trim()
  });
  save(); closeModal('log-modal'); renderAll();
}

function deleteLog(id) {
  state.logs = state.logs.filter(l => l.id !== id);
  save(); renderAll();
}

// ---- REMINDERS ----
function selectRType(t) {
  currentRType = t;
  ['water','fertilize','other'].forEach(x => {
    document.getElementById('rchip-' + x).classList.toggle('selected', x === t);
  });
}

function saveReminder() {
  const label = document.getElementById('reminder-label').value.trim();
  const date = document.getElementById('reminder-date').value;
  if (!label || !date) { alert('Please add a label and date.'); return; }
  state.reminders.push({
    id: Date.now().toString(),
    plantId: document.getElementById('reminder-plant-select').value,
    type: currentRType,
    label,
    freq: document.getElementById('reminder-freq').value,
    date
  });
  save(); closeModal('reminder-modal'); renderAll();
}

function deleteReminder(id) {
  state.reminders = state.reminders.filter(r => r.id !== id);
  save(); renderAll();
}

// ---- NOTES ----
function saveNote() {
  const category = document.getElementById('note-category').value.trim();
  const content = document.getElementById('note-content').value.trim();
  if (!category) { alert('Please enter a category.'); return; }
  const id = document.getElementById('note-edit-id').value;
  const note = { id: id || Date.now().toString(), category, content };
  if (id) { state.notes = state.notes.map(n => n.id === id ? note : n); }
  else { state.notes.push(note); }
  save(); closeModal('note-modal'); renderAll();
}

function deleteNote(id) {
  state.notes = state.notes.filter(n => n.id !== id);
  save(); renderAll();
}

function toggleNote(id) {
  document.getElementById('nbody-' + id).classList.toggle('open');
}

// ---- HELPERS ----
function populatePlantSelect(selId, allowBlank) {
  const sel = document.getElementById(selId);
  sel.innerHTML = allowBlank ? '<option value="">All plants / General</option>' : '<option value="">Select a plant...</option>';
  state.plants.forEach(p => {
    const opt = document.createElement('option');
    opt.value = p.id; opt.textContent = p.name;
    sel.appendChild(opt);
  });
}

function plantName(id) {
  const p = state.plants.find(p => p.id === id);
  return p ? p.name : 'Unknown plant';
}

function formatDate(d) {
  if (!d) return '';
  const dt = new Date(d + 'T00:00:00');
  return dt.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
}

function daysUntil(d) {
  const t = new Date(); t.setHours(0,0,0,0);
  const target = new Date(d + 'T00:00:00');
  const diff = Math.round((target - t) / 86400000);
  if (diff < 0) return `${Math.abs(diff)}d overdue`;
  if (diff === 0) return 'Today';
  if (diff === 1) return 'Tomorrow';
  return `In ${diff} days`;
}

const freqLabel = { daily:'Daily', '2days':'Every 2 days', weekly:'Weekly', '2weeks':'Every 2 weeks', monthly:'Monthly' };
const typeIcon = { water: 'ğŸ’§', fertilize: 'ğŸŒ¾', other: 'ğŸ“‹' };

// ---- RENDER ----
function renderAll() {
  renderInventory();
  renderLog();
  renderReminders();
  renderNotes();
}

function renderInventory() {
  const list = document.getElementById('plant-list');
  const filtered = state.plants.filter(p => (p.env || 'outdoor') === currentEnvFilter);
  const total = state.plants.length;
  document.getElementById('plant-count').textContent = total ? `${total} plant${total !== 1 ? 's' : ''}` : '';
  if (!filtered.length) {
    const label = currentEnvFilter === 'indoor' ? 'indoor' : 'outdoor';
    list.innerHTML = `<div class="empty"><div class="empty-icon">${currentEnvFilter === 'indoor' ? 'ğŸªŸ' : 'ğŸŒ¿'}</div><div class="empty-text">No ${label} plants yet.<br>Tap + to add one!</div></div>`;
    return;
  }
  list.innerHTML = filtered.map(p => {
    const photos = p.photos || [];
    const lastLog = [...state.logs].filter(l => l.plantId === p.id).sort((a,b) => b.date.localeCompare(a.date))[0];
    const latestPhoto = [...photos].sort((a,b) => (b.date||'').localeCompare(a.date||''))[0];

    const galleryHTML = photos.length ? `
      <div class="photo-gallery">
        ${[...photos].sort((a,b) => (a.date||'').localeCompare(b.date||'')).map((ph, i) => `
          <div class="gallery-item" onclick="openLightbox(${JSON.stringify(JSON.stringify([...photos].sort((a,b)=>(a.date||'').localeCompare(b.date||''))))}, ${i})">
            <img src="${ph.data}">
            ${ph.date ? `<div class="gallery-item-date">${formatDate(ph.date)}</div>` : ''}
          </div>
        `).join('')}
      </div>
    ` : '';

    return `
    <div class="plant-card">
      <div class="plant-card-header" onclick="togglePlantCard('${p.id}')">
        <div class="plant-photo" style="position:relative">
          ${latestPhoto ? `<img src="${latestPhoto.data}">` : 'ğŸª´'}
          ${latestPhoto && latestPhoto.date ? `<div style="position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.5);color:white;font-size:8px;text-align:center;padding:2px 0;border-radius:0 0 12px 12px;font-weight:500">${formatDate(latestPhoto.date)}</div>` : ''}
        </div>
        <div class="plant-info">
          <div class="plant-name">${p.name}</div>
          <div class="plant-meta">${[p.type, p.location].filter(Boolean).join(' Â· ')}</div>
          ${photos.length > 1 ? `<div class="plant-meta" style="margin-top:2px">ğŸ“¸ ${photos.length} photos</div>` : ''}
          ${lastLog ? `<div class="plant-meta" style="margin-top:2px">${typeIcon[lastLog.type]} Last ${lastLog.type === 'water' ? 'watered' : 'fertilized'} ${formatDate(lastLog.date)}</div>` : ''}
        </div>
        ${p.type ? `<div class="plant-tag">${p.type}</div>` : ''}
      </div>
      <div class="plant-card-body" id="pbody-${p.id}">
        ${galleryHTML}
        ${(p.soil || p.light || p.humidity || p.repotDate) ? `
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px">
            ${p.soil ? `<span style="font-size:12px;background:#f0ebe0;color:var(--soil);padding:4px 10px;border-radius:20px">ğŸª± ${p.soil}</span>` : ''}
            ${p.light ? `<span style="font-size:12px;background:#fffbe6;color:#8a6d00;padding:4px 10px;border-radius:20px">${p.light === 'Full Sun' ? 'â˜€ï¸' : p.light === 'Partial Sun' ? 'â›…' : p.light === 'Shade' ? 'ğŸŒ¥ï¸' : 'ğŸªŸ'} ${p.light}</span>` : ''}
            ${p.humidity ? `<span style="font-size:12px;background:#e8f4fb;color:#2a6d8a;padding:4px 10px;border-radius:20px">${p.humidity === 'Low' ? 'ğŸœï¸' : p.humidity === 'Medium' ? 'ğŸŒ¤ï¸' : 'ğŸ’¦'} ${p.humidity} Humidity</span>` : ''}
            ${p.repotDate ? `<span style="font-size:12px;background:#f0ebe0;color:var(--soil);padding:4px 10px;border-radius:20px">ğŸª´ Repotted ${formatDate(p.repotDate)}</span>` : ''}
          </div>` : ''}
        ${p.notes ? `<div style="font-size:13px;line-height:1.6;margin-bottom:12px">${p.notes}</div>` : ''}
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="btn btn-sm btn-water" onclick="quickLog('${p.id}','water')">ğŸ’§ Log Water</button>
          <button class="btn btn-sm btn-fertilize" onclick="quickLog('${p.id}','fertilize')">ğŸŒ¾ Log Feed</button>
          <button class="btn btn-sm" onclick="openPlantModal('${p.id}')">âœï¸ Edit / Add Photo</button>
          <button class="btn btn-sm btn-danger" onclick="deletePlant('${p.id}')">ğŸ—‘</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function quickLog(plantId, type) {
  populatePlantSelect('log-plant-select');
  document.getElementById('log-plant-select').value = plantId;
  document.getElementById('log-date').value = today();
  document.getElementById('log-product').value = '';
  document.getElementById('log-quantity').value = '';
  document.getElementById('log-notes').value = '';
  selectType(type);
  openModal('log-modal');
}

function renderLog() {
  const list = document.getElementById('log-list');
  const logs = [...state.logs].sort((a,b) => b.date.localeCompare(a.date));
  if (!logs.length) {
    list.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ’§</div><div class="empty-text">No log entries yet.<br>Tap + to log watering or feeding.</div></div>`;
    return;
  }
  list.innerHTML = logs.map(l => `
    <div class="log-entry">
      <div class="log-dot ${l.type}">${typeIcon[l.type]}</div>
      <div class="log-info">
        <div class="log-plant">${plantName(l.plantId)}</div>
        <div class="log-details">${l.type === 'water' ? 'Watered' : 'Fertilized'}${l.product ? ` Â· ${l.product}` : ''}${l.quantity ? ` Â· ${l.quantity}` : ''}${l.notes ? `<br><span style="color:var(--text)">${l.notes}</span>` : ''}</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
        <div class="log-date">${formatDate(l.date)}</div>
        <button class="btn btn-sm btn-danger" style="padding:4px 8px;font-size:11px" onclick="deleteLog('${l.id}')">âœ•</button>
      </div>
    </div>
  `).join('');
  list.innerHTML = `<div class="card">${list.innerHTML}</div>`;
}

function renderReminders() {
  const list = document.getElementById('reminder-list');
  if (!state.reminders.length) {
    list.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ””</div><div class="empty-text">No reminders set.<br>Tap + to create a schedule.</div></div>`;
    return;
  }
  const sorted = [...state.reminders].sort((a,b) => a.date.localeCompare(b.date));
  list.innerHTML = sorted.map(r => {
    const due = daysUntil(r.date);
    const overdue = r.date < today();
    return `
    <div class="reminder-card">
      <div class="reminder-icon" style="background:${r.type==='water'?'#e0f0f8':r.type==='fertilize'?'#fdf3dc':'#f0f0f0'}">${typeIcon[r.type]}</div>
      <div style="flex:1">
        <div style="font-weight:500;font-size:14px">${r.label}</div>
        <div style="font-size:12px;color:var(--text-muted);margin-top:2px">${r.plantId ? plantName(r.plantId) : 'All plants'} Â· ${freqLabel[r.freq]}</div>
        <div style="font-size:12px;margin-top:4px;font-weight:500;color:${overdue?'var(--danger)':'var(--sage-dark)'}">${due}</div>
      </div>
      <button class="btn btn-sm btn-danger" onclick="deleteReminder('${r.id}')">âœ•</button>
    </div>`;
  }).join('');
}

function renderNotes() {
  const list = document.getElementById('note-list');
  if (!state.notes.length) {
    list.innerHTML = `<div class="empty"><div class="empty-icon">ğŸ““</div><div class="empty-text">No notes yet.<br>Tap + to record your nutrient mixes.</div></div>`;
    return;
  }
  list.innerHTML = state.notes.map(n => `
    <div class="note-card">
      <div class="note-card-header" onclick="toggleNote('${n.id}')">
        <div class="note-category">${n.category}</div>
        <div style="display:flex;gap:8px">
          <button class="btn btn-sm" onclick="event.stopPropagation();openNoteModal('${n.id}')">âœï¸</button>
          <button class="btn btn-sm btn-danger" onclick="event.stopPropagation();deleteNote('${n.id}')">ğŸ—‘</button>
        </div>
      </div>
      <div class="note-card-body" id="nbody-${n.id}">${n.content || '<em style="color:var(--text-muted)">No content yet.</em>'}</div>
    </div>
  `).join('');
}

// ---- INIT ----
(function() {
  try {
    const session = localStorage.getItem('gk_session');
    if (session) {
      const user = JSON.parse(session);
      // Verify user still exists
      const users = getUsers();
      if (users[user.username]) {
        loginSuccess(user.username, user.name);
        return;
      }
    }
  } catch(e) {}
  // No valid session â€” show auth screen
  document.getElementById('auth-screen').classList.add('open');
})();
document.getElementById('log-date').value = today();
document.getElementById('reminder-date').value = today();
</script>

</body>
</html>
